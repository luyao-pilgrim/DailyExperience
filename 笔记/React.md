# React

## JSX

JSX-->React.createElement-->fiberå¯¹è±¡

![](C:\Users\é™†é¥\Desktop\DailyExperience\ç¬”è®°\images\2023-01-24-16-12-37-image.png)

children, return, sibling

`createElement`Â å‚æ•°ï¼š  

- ç¬¬ä¸€ä¸ªå‚æ•°ï¼šå¦‚æœæ˜¯ç»„ä»¶ç±»å‹ï¼Œä¼šä¼ å…¥ç»„ä»¶å¯¹åº”çš„ç±»æˆ–å‡½æ•°ï¼›å¦‚æœæ˜¯ dom å…ƒç´ ç±»å‹ï¼Œä¼ å…¥ div æˆ–è€… span ä¹‹ç±»çš„å­—ç¬¦ä¸²ã€‚

- ç¬¬äºŒä¸ªå‚æ•°ï¼šä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨ dom ç±»å‹ä¸­ä¸ºæ ‡ç­¾å±æ€§ï¼Œåœ¨ç»„ä»¶ç±»å‹ä¸­ä¸º props ã€‚

- å…¶ä»–å‚æ•°ï¼šä¾æ¬¡ä¸º childrenï¼Œæ ¹æ®é¡ºåºæ’åˆ—ã€‚

**å¯æ§æ€§render?**

## ç»„ä»¶é€šä¿¡ä¸»æµ

React ä¸€å…±æœ‰ 5 ç§ä¸»æµçš„é€šä¿¡æ–¹å¼ï¼š

1. props å’Œ callback æ–¹å¼
2. ref æ–¹å¼ã€‚
3. React-redux æˆ– React-mobx çŠ¶æ€ç®¡ç†æ–¹å¼ã€‚
4. context ä¸Šä¸‹æ–‡æ–¹å¼ã€‚
5. event bus äº‹ä»¶æ€»çº¿ã€‚

## hooksä¸ºä»€ä¹ˆä¸èƒ½å†™åœ¨æ¡ä»¶åˆ¤æ–­orå¾ªç¯è¯­å¥å†…ï¼Ÿ

æºç å¯ä»¥çœ‹ä½œç»´æŠ¤ä¸€ä¸ªç»„ä»¶å…¨å±€çš„è¡¨ï¼Œstateå’Œsettersä¸€ä¸€å¯¹åº”ï¼Œä»¥indexä¸€ä¸€å¯¹åº”ï¼Œå¦‚æœæŒ‰æ¡ä»¶çœ‹æ˜¯ä¸æ˜¯æ‰§è¡Œçš„è¯ï¼Œè¯»å–è¿™äº›å¯¹åº”å…³ç³»æ—¶å€™å°±ä¼šé”™ä½

## æ€§èƒ½ä¼˜åŒ–useMemo,useCallback

render-->stateæ”¹å˜æ—¶å€™
React.memoåŒ…è£¹å­ç»„ä»¶-->é—®é¢˜ï¼špropsæ˜¯å¯¹è±¡ç­‰å¤æ‚æ•°æ®ç±»å‹ï¼Œä»ä¼šre-render
useMemo,useCallback-->çˆ¶ç»„ä»¶éœ€è¦æŠŠå˜é‡ï¼Œå‡½æ•°ä½œä¸ºpropså¾€ä¸‹ä¼ çš„æ—¶å€™ï¼Œé¿å…re-renderå»åŒ…è£¹

## forwardRef+useImprenative

ref:å¯¹DOMå…ƒç´ çš„åŸç”Ÿæ§åˆ¶ï¼Œç„¦ç‚¹ï¼Œscrollï¼Œè§†é¢‘éŸ³é¢‘æ’­æ”¾ç­‰ç­‰
forwardRef+useImperativeHandle-->å‡½æ•°ç»„ä»¶ä¸èƒ½ç›´æ¥ä½¿ç”¨refï¼Œé€šè¿‡fowardRefè½¬å‘ï¼Œä½¿å¾—çˆ¶ç»„ä»¶å¯ä»¥æ§åˆ¶å­ç»„ä»¶ä¸­çš„DOM
useImperativeHandle:å¯ä»¥æ§åˆ¶å­ç»„ä»¶å¤šä¸ªref

## æ•°æ®åŒå‘ç»‘å®šin React

æƒ…å†µï¼šåœ¨ä½¿ç”¨input,textarea,checkbox,selectç­‰åœºæ™¯ä¸‹çš„åŒå‘ç»‘å®š

å—æ§ç»„ä»¶+onChange handler

## Re-render

stateæ”¹å˜æ˜¯re-renderçš„å”¯ä¸€å› ç´ 

é—®é¢˜ï¼Œå¦‚æœpropsæ˜¯objectï¼Œæ€ä¹ˆåŠï¼Ÿ-->æ¯æ¬¡functionæ‰§è¡Œéƒ½æ˜¯æ–°çš„ï¼Œæ¯æ¬¡è¿™ä¸ªobjectå³ä½¿æ²¡æœ‰æ”¹å˜ä¹Ÿæ˜¯æ–°çš„-->ä¸ç®¡æœ‰æ²¡æœ‰memoåŒ…è£…éƒ½æ˜¯ä¼šre-renderï¼Œè¿™æ—¶å€™éœ€è¦åœ¨ä¸Šä¸€å±‚ç”¨useMemoåŒ…è£…

## React-Router v6

## Reactè®¾è®¡æ¨¡å¼

## ç”Ÿå‘½å‘¨æœŸä»¥åŠå¯¹åº”çš„effecté’©å­

åˆ›å»º->åˆå§‹åŒ–æ•°æ®->ç¼–è¯‘æ¨¡æ¿->æŒ‚è½½DOM->æ¸²æŸ“ï¼Œæ›´æ–°->å¸è½½

![](C:\Users\é™†é¥\Desktop\DailyExperience\ç¬”è®°\images\2023-02-07-09-58-50-image.png)

1.åˆ›å»ºé˜¶æ®µï¼š

**constructor**:æ•°æ®åˆå§‹åŒ–

**getDerivedStateFromProps**:è§‚å¯Ÿstateæ˜¯å¦å»å—åˆ°propsçš„å½±å“

åœ¨æ¯æ¬¡`render`æ–¹æ³•å‰è°ƒç”¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå³å°†æ›´æ–°çš„`props`ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸Šä¸€ä¸ªçŠ¶æ€çš„`state`ï¼Œå¯ä»¥æ¯”è¾ƒ`props`Â å’ŒÂ `state`æ¥åŠ ä¸€äº›é™åˆ¶æ¡ä»¶ï¼Œé˜²æ­¢æ— ç”¨çš„stateæ›´æ–°

**render**ï¼šä¼šæ’å…¥jsxç”Ÿæˆçš„domç»“æ„ï¼Œreactä¼šç”Ÿæˆä¸€ä»½è™šæ‹Ÿdomæ ‘ï¼Œåœ¨æ¯ä¸€æ¬¡ç»„ä»¶æ›´æ–°æ—¶ï¼Œåœ¨æ­¤reactä¼šé€šè¿‡å…¶diffç®—æ³•æ¯”è¾ƒæ›´æ–°å‰åçš„æ–°æ—§DOMæ ‘ï¼Œæ¯”è¾ƒä»¥åï¼Œæ‰¾åˆ°æœ€å°çš„æœ‰å·®å¼‚çš„DOMèŠ‚ç‚¹ï¼Œå¹¶é‡æ–°æ¸²æŸ“ã€‚

**componentDidMount**:æ•°æ®è·å–ï¼ŒDOMäº‹ä»¶ç»‘å®š

2.æ›´æ–°é˜¶æ®µï¼š

3.é”€æ¯é˜¶æ®µ

## hookså¤§å…¨

![](C:\Users\é™†é¥\Desktop\DailyExperience\ç¬”è®°\images\2023-01-17-17-05-33-image.png)

**why hooks?**

1.å…¨é¢æ‹¥æŠ±å‡½æ•°å¼ç¼–ç¨‹ï¼ˆå¦‚ä½•å»ç†è§£ï¼‰

2.æ›´å¥½çš„é€»è¾‘å¤ç”¨ï¼Œå¯ä»¥å»è‡ªå®šä¹‰hooks

### 1.æ•°æ®æ›´æ–°é©±åŠ¨

**1.useState**

- **setStateçš„é—­åŒ…é—®é¢˜**

1.Indexåœºæ™¯ï¼Œ`setTinterval`æ¯ä¸€æ¬¡éƒ½æ˜¯æ–°åˆ›å»ºï¼Œæ¯æ¬¡åˆ›å»ºéƒ½æ˜¯é—­åŒ…`number`æŒ‡å®šä¸ºäº†0ï¼Œä¸ä¼šæ”¹å˜

2.Counteråœºæ™¯ï¼Œä¼ å…¥ç©ºçš„ä¾èµ–æ•°ç»„Â `[]`ï¼Œæ„å‘³ç€è¯¥ hook åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶è¿è¡Œä¸€æ¬¡ï¼Œå¹¶éé‡æ–°æ¸²æŸ“æ—¶ã€‚ä½†å¦‚æ­¤ä¼šæœ‰é—®é¢˜ï¼Œåœ¨Â `setInterval`Â çš„å›è°ƒä¸­ï¼Œ`count`Â çš„å€¼ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚å› ä¸ºå½“ effect æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªé—­åŒ…ï¼Œå¹¶å°†Â `count`Â çš„å€¼è¢«ä¿å­˜åœ¨è¯¥é—­åŒ…å½“ä¸­ï¼Œä¸”åˆå€¼ä¸ºÂ `0`ã€‚æ¯éš”ä¸€ç§’ï¼Œå›è°ƒå°±ä¼šæ‰§è¡ŒÂ `setCount(0 + 1)`ï¼Œå› æ­¤ï¼Œ`count`Â æ°¸è¿œä¸ä¼šè¶…è¿‡ 1ã€‚

åŸç†ä¸€æ ·çš„ï¼Œé—­åŒ…-->è§£å†³ï¼šè®¾ç½®ä¾èµ–é¡¹orä½¿ç”¨setStateå‡½æ•°å¼æ›´æ–°

```jsx
function Index(){
    const [ number, setNumber ] = React.useState(0)
    const handleClick = () => setInterval(()=>{
        // æ­¤æ—¶ number ä¸€ç›´éƒ½æ˜¯ 0
        setNumber(number + 1 ) 
    },1000)
    //ä¹‹åä¸€ç›´éƒ½æ˜¯åŒä¸€ä¸ªsetIntervaläº†æ‰€ä»¥numberéƒ½æ˜¯0
    return <button onClick={ handleClick } > ç‚¹å‡» { number }</button>
}


function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const id = setInterval(() => {
      setCount(count + 1); // è¿™ä¸ª effect ä¾èµ–äº `count` state
    }, 1000);
    return () => clearInterval(id);
  }, []); // ğŸ”´ Bug: `count` æ²¡æœ‰è¢«æŒ‡å®šä¸ºä¾èµ–

  return <h1>{count}</h1>;
}
```

- **setStateå‡½æ•°å¼æ›´æ–°**

ä¼šè‡ªåŠ¨å‚æ•°å¸¦ä¸Šæœ€æ–°çš„stateå€¼ï¼Œä¸ä¼šå»æœ‰é—­åŒ…é—®é¢˜ï¼Œæ‰€ä»¥æœ€å¥½æ¯æ¬¡éƒ½ç”¨å‡½æ•°å¼æ›´æ–°

- **setStateæ›´æ–°æœºåˆ¶**

18å‰-->æ‰¹é‡æ›´æ–°æœºåˆ¶bathedupdate,ä½¿ç”¨å¼‚æ­¥setTimeout or promiseå¯ä»¥æ‰“ç ´è¿™ä¸ªæœºåˆ¶ï¼Œæœ‰`unstable_batchedUpdates`æ–¹æ³•å¯ä»¥åœ¨å¼‚æ­¥ä¸­ä¹Ÿä½¿ç”¨æ‰¹é‡æ›´æ–°

18-->éƒ½æ˜¯å¼‚æ­¥ï¼Œä¼šå»è‡ªåŠ¨è¿›è¡Œæ‰¹é‡æ›´æ–°ï¼Œä¸å—å¼‚æ­¥é™åˆ¶

###### setStateæ‰§è¡Œæœºåˆ¶ï¼Ÿ

1.åŒæ­¥ï¼Œå¼‚æ­¥éƒ½å¯èƒ½å‘ç”Ÿ
setTimeout,åŸç”ŸDOMä¸­æ˜¯åŒæ­¥ï¼ŒReactäº‹ä»¶ä¸­æ˜¯å¼‚æ­¥
2.æ‰¹é‡æ›´æ–°ç­–ç•¥
æœ‰ç‚¹ç±»ä¼¼äºObject.assign

ç±»ç»„ä»¶ä¸­setState-->

è°ƒç”¨ setState æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯ React åº•å±‚è°ƒç”¨ Updater å¯¹è±¡ä¸Šçš„ enqueueSetState æ–¹æ³•ã€‚æ‰¹é‡æ›´æ–°ï¼Œå®é™…ç”¨åˆ°äº†äº‹ä»¶ç³»ç»Ÿä¸­batchedEventUpdates æ–¹æ³•ï¼Œåœ¨ React äº‹ä»¶æ‰§è¡Œä¹‹å‰é€šè¿‡Â `isBatchingEventUpdates=true`Â æ‰“å¼€å¼€å…³ï¼Œå¼€å¯äº‹ä»¶æ‰¹é‡æ›´æ–°ï¼Œå½“è¯¥äº‹ä»¶ç»“æŸï¼Œå†é€šè¿‡Â `isBatchingEventUpdates = false;`Â å…³é—­å¼€å…³ï¼Œç„¶ååœ¨ scheduleUpdateOnFiber ä¸­æ ¹æ®è¿™ä¸ªå¼€å…³æ¥ç¡®å®šæ˜¯å¦è¿›è¡Œæ‰¹é‡æ›´æ–°ã€‚

åœ¨å¼‚æ­¥ä¸­ï¼Œæ‰§è¡Œå»¶åï¼ŒisBatchingEventUpdateså·²ç»è®¾ç½®ä¸ºfalseå•¦

**2.useReducer**

ç±»ä¼¼äºåœ¨ç»„ä»¶ä¸­ç›´æ¥reduxé€»è¾‘

```jsx
const DemoUseReducer = ()=>{
    /* numberä¸ºæ›´æ–°åçš„stateå€¼,  dispatchNumbner ä¸ºå½“å‰çš„æ´¾å‘å‡½æ•° */
   const [ number , dispatchNumbner ] = useReducer((state,action)=>{
       const { payload , name  } = action
       /* returnçš„å€¼ä¸ºæ–°çš„state */
       switch(name){
           case 'add':
               return state + 1
           case 'sub':
               return state - 1 
           case 'reset':
             return payload       
       }
       return state
   },0)
   return <div>
      å½“å‰å€¼ï¼š{ number }
      { /* æ´¾å‘æ›´æ–° */ }
      <button onClick={()=>dispatchNumbner({ name:'add' })} >å¢åŠ </button>
      <button onClick={()=>dispatchNumbner({ name:'sub' })} >å‡å°‘</button>
      <button onClick={()=>dispatchNumbner({ name:'reset' ,payload:666 })} >èµ‹å€¼</button>
      { /* æŠŠdispatch å’Œ state ä¼ é€’ç»™å­ç»„ä»¶  */ }
      <MyChildren  dispatch={ dispatchNumbner } State={{ number }} />
   </div>
}
```

**3.useTransition**

å¦‚æœä¸€æ¬¡äº‹ä»¶è§¦å‘æœ‰å¤šä¸ªä¼˜å…ˆçº§ä»»åŠ¡

æ¯”å¦‚tabåˆ‡æ¢ï¼š1.tabæ ‡ç­¾æ ·å¼ 2.tab contentå†…å®¹åˆ‡æ¢

æ˜æ˜¾tab contentä¼˜å…ˆçº§ä½ï¼Œå¯ä»¥ä¼˜é›…çš„ä½¿ç”¨useTransitionåœ¨æ•°æ®è¿˜æ²¡æœ‰è¿”å›çš„æ—¶å€™æœ‰loadingç•Œé¢-->è®©startTransitioné‡Œé¢çš„setStateä»»åŠ¡ä¼˜å…ˆçº§æ»å

### 2.æ‰§è¡Œå‰¯ä½œç”¨

**1.useEffect**

ä¸ºä»€ä¹ˆå«åšå‰¯ä½œç”¨-->ç›¸å½“äºçº¯å‡½æ•°çš„å‰¯ä½œç”¨ï¼Œå’Œå¤–éƒ¨å˜é‡æœ‰äº†äº¤äº’

åœ¨Reactä¸­-->ä¸æ˜¯state,propsçš„å˜é‡å½±å“

é—®é¢˜ï¼šåˆ°åº•ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼ŸDOMåï¼Ÿæ˜¯æ¸²æŸ“åå†å»setState?

è§£ç­”ï¼šæ˜¯åœ¨çœŸå®DOMç”Ÿæˆå¹¶æŒ‚è½½ä¹‹åå†å»useEffectï¼Œç±»æ¯”didMount,didUpdateï¼Œç†è§£çš„æ—¶å€™å¯ä»¥å¸¦ä¸Šç”Ÿå‘½å‘¨æœŸå›¾

returnçš„æ¸…é™¤ä½œç”¨æ—¶æœºæ˜¯ï¼š

1.render-->clearä¸Šä¸€æ¬¡-->è¿™ä¸€æ¬¡æ–°çš„effect(åŒæ—¶æŠŠè¿™ä¸€æ¬¡çš„ç»‘å®šä¸Šè¿™ä¸€æ¬¡çš„return)

2.ç»„ä»¶é”€æ¯æ—¶å€™

**2.useLayoutEffect**

## immutable.js+memoæµ…æ¯”è¾ƒçš„æ›´æ–°æ–¹æ¡ˆ

æ€»ç»“èµ·æ¥å°±æ˜¯æƒ³åœ¨å¯¹reactç»„ä»¶è¿›è¡Œæ€§èƒ½ä¼˜åŒ–æ—¶ï¼Œéœ€è¦ç›‘æµ‹stateæˆ–propsçš„å˜åŒ–æ¥åˆ¤æ–­æ˜¯å¦renderï¼Œè€Œæ€ä¹ˆç›‘æµ‹å˜åŒ–=>ç”¨æµ…æ¯”è¾ƒï¼Œä½†æµ…æ¯”è¾ƒå­˜åœ¨æ›´æ–°å¯¹è±¡å±æ€§æ—¶å¼•ç”¨æ²¡å˜çš„é—®é¢˜ï¼Œæ‰€ä»¥åªè¦èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæµ…æ¯”è¾ƒä¾ç„¶æ˜¯å¥½æ–¹æ¡ˆï¼Œå› æ­¤immutableçš„å‡ºç°è§£å†³çš„å°±æ˜¯æœ‰å˜åŒ–å°±è¿”å›æ–°å¼•ç”¨ï¼Œæ•…è€Œæµ…æ¯”è¾ƒ+immutableå°±æ˜¯æ€§èƒ½ä¼˜åŒ–çš„åˆ©å™¨ï¼Œç„¶ååé¢å‡ºç°çš„Immeræ˜¯æ¯”immutableæ›´å¥½çš„æ–¹æ¡ˆ
